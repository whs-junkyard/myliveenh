(function(){
	'use strict';

	let element = document.getElementById('enh__streammeta');
	let lastMeta = {};
	let paused = false;
	let bannedKeys = ['Server'];

	playerInstance.on('meta', (meta) => {
		if(meta && meta.type === 'meta'){
			Object.assign(lastMeta, meta.metadata);
		}
	});

	let update = () => {
		let keys = Object.keys(lastMeta).sort();
		let text = [];

		for(let key in keys){
			key = keys[key];
			if(bannedKeys.includes(key)){
				continue;
			}
			text.push(`${key}: ${lastMeta[key]}`);
		}

		element.textContent = 'MyLiveEnh Stream Metadata\nHover to expand\n'
			+ text.join('\n')
			+ '\nDouble click to pause\nDisable at MyLiveEnh settings';
	};

	let interval = setInterval(update, 1000);

	element.addEventListener('dblclick', () => {
		paused = !paused;

		if(paused){
			clearInterval(interval);
		}else{
			setInterval(update, 1000);
		}

		element.classList.toggle('enh__paused');
	}, false);
})();
